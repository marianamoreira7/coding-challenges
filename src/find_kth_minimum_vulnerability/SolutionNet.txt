class Solution {
public:
    vector<int> findKthMinimumVulnerability(int k, int m, vector<int> nums) {
        set<pair<int, int>>left, right;
        //set<pair<int, int>, greater<pair<int, int>>>right;
        int n = nums.size();
        int j = 0;
        vector<int>res;
        for (int i = 0; i < n; i++) {

            left.insert({ nums[i], i });
            if (i - j == m) {
                if (left.count({ nums[j], j })) {
                    left.erase({ nums[j], j });
                }
                else {
                    assert(right.size())
                    right.erase({ nums[j], j });
                }
                j++;
            }
            if (left.size() > k) {
                right.insert(*left.rbegin());
                left.erase(*left.rbegin());
            }
            if (left.size() && right.size() && left.rbegin()->first > right.begin()->first) {
                auto it = *right.begin();
                right.insert(*left.rbegin());
                left.erase(prev(left.end()));
                right.erase(it);
                left.insert(it);
            }

            if (i + 1 >= m) {
                assert(left.size())
                res.push_back(left.rbegin()->first);
            }
        }
        return res;
    }
};